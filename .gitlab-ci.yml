image: registry.opensuse.org/opensuse/leap:latest

stages:
  - mirror

mirror-from-github:
    stage: mirror
    rules:
          - if: $TOKEN
    before_script:
        - source /etc/os-release && zypper ar http://download.suse.de/ibs/SUSE:/CA/openSUSE_Leap_${VERSION}/SUSE:CA.repo
        - zypper -n in git ca-certificates-suse
    script:
        - git config user.email "you@example.com"
        - git config user.name "Your Name"
        - git remote add github https://github.com/os-autoinst/os-autoinst-needles-opensuse
        - git fetch github master:gmaster
        - git remote set-url origin https://gitlab:${TOKEN}@gitlab.suse.de/openqa/os-autoinst-needles-opensuse-mirror.git
        - git push -f origin gmaster:master
